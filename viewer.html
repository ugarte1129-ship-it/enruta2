<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Viewer de Rutas</title>

```
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }
    #map {
        height: 100vh;
        width: 100vw;
    }
    .selector {
        position: absolute;
        top: 15px;
        left: 15px;
        background: white;
        padding: 12px;
        border-radius: 12px;
        z-index: 1000;
        box-shadow: 0px 3px 8px rgba(0,0,0,0.15);
    }
    select {
        padding: 8px;
        width: 140px;
    }
</style>
```

</head>

<body>

<div class="selector">
    <select id="unitSelect">
        <option value="">Selecciona unidad</option>
        <option value="RA">RA</option>
        <option value="RP">RP</option>
        <option value="RV">RV</option>
        <option value="RS">RS</option>
    </select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    // ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyA5pec-pqAnksqEKocrUv0HImO0H-qINDY",
        authDomain: "pgps-252ee.firebaseapp.com",
        databaseURL: "https://pgps-252ee-default-rtdb.firebaseio.com/",
        projectId: "pgps-252ee",
        storageBucket: "pgps-252ee.appspot.com",
        messagingSenderId: "310435537463",
        appId: "1:310435537463:web:9a0086d69a05b3b7fb2537"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Inicializar mapa
    let map = L.map('map').setView([22.15, -100.98], 13);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

    let marker = null;
    let activeListener = null;

    const unitSelect = document.getElementById("unitSelect");

    unitSelect.addEventListener("change", function () {
        const busID = this.value;

        if (!busID) return;

        // Desactivar listener anterior
        if (activeListener) {
            activeListener.off();
        }

        // Crear nuevo listener
        activeListener = db.ref("ubicaciones/" + busID);
        activeListener.on("value", snapshot => {
            const data = snapshot.val();
            console.log("Datos recibidos:", data);

            if (!data || !data.lat || !data.lng) return;

            const { lat, lng } = data;

            if (!marker) {
                marker = L.marker([lat, lng]).addTo(map);
            } else {
                marker.setLatLng([lat, lng]);
            }

            map.setView([lat, lng], 15);
        });
    });
</script>

</body>
</html>
